---
title: "netReg R tutorial"
bibliography: netReg.bib
---

This document explains how to install and use the `R` package. 

## Installation

You can install and use `netReg` either

* as an `R` library from [Bioconductor](https://bioconductor.org/packages/release/bioc/html/netReg.html),
* or by downloading the latest [tarball](https://github.com/dirmeier/netReg/releases/).

### Installation with Bioconductor

The easiest way to install `netReg` is using the `R`-console:

```{r, eval=FALSE}
> source("https://bioconductor.org/biocLite.R")
> biocLite("netReg")

> library(netReg)
```
 
### Manual installation
 
If you want to build the package yourself first download the tarball of the 
latest [release](https://github.com/dirmeier/netReg/releases/) and then call:

```bash
$ R CMD install <netReg-x.y.z.tar.gz>
```
 
That's it.
 
## Usage

This section explains how to fit a linear model and do parameter estimation. 

At first we load the library and some data:

```{r, eval=FALSE}
> library(netReg)
> data("yeast")

> ls(yeast)
[1] "GX" "X" "Y"

> X <- yeast$X[, 1:5]
> Y <- yeast$Y[, 40:45]
> GY <- yeast$GY[40:45, 40:45]
```

The *yeast* data $\mathbf{X}$ and $\mathbf{Y}$ set is taken and adopted from [@brem2005genetic], [@storey2005multiple], and [@cheng2014graph].
$\mathbf{GY}$ is taken from [BioGRID](https://thebiogrid.org/downloads/archives/Release%20Archive/BIOGRID-3.4.150/BIOGRID-ORGANISM-3.4.150.tab.zip).
$\mathbf{X}$ is a $(n \times p)$ matrix of genetic markers where $n$ is the number of samples (112) and $p$ is the number of markers.
$\mathbf{Y}$ is a $(n \times q)$ matrix of expression values for $q$ yeast genes. $n$ is again the numer of samples (112).
$\mathbf{GY}$ is a $(q \times q)$ adjacency matrix representing protein-protein interactions for the $q$ response variables.

We only use a smaller network in order to be able to print the results here.

### Model fitting

Fitting a model using edge-based regularization with `netReg` can be done like that:

```{r, eval=FALSE}
> fit <- edgenet(X=X,
                 Y=Y, 
                 G.Y=GY,
                 lambda=10, psigy=1, family="gaussian")
> fit

Call: edgenet.default(X = X, Y = Y, G.Y = GY, lambda = 10, psigy = 1, 
    family = "gaussian")

Coefficients:
               YBL113C   YBR013C YBR014C YBR016W YBR025C YBR028C
marker_2036 0.18880586 0.0000000       0       0       0       0
marker_349  0.32480670 0.1267092       0       0       0       0
marker_2596 0.00000000 0.0000000       0       0       0       0
marker_2987 0.07526014 0.0000000       0       0       0       0
marker_994  0.16888058 0.0000000       0       0       0       0

Intercept:
            [,1]
[1,]  0.22068539
[2,]  0.17820179
[3,] -0.08242679
[4,] -0.13699107
[5,]  0.09521875
[6,]  0.09709554

Parameters:
lambda psi_gx psi_gy 
    10      0      1 

Family:
[1] "gaussian"
```

For the response variables we use an affinity matrix that represents *biological relationships* with $\mathbf{GY}$.
We promote sparsity by setting $\lambda = 10$ and put a week penalty on similar coefficients by setting $\psi_{gy} = 1$. Other than that we used standard parameters in this case.

The `fit` object contains information about coefficients and intercepts. Having the coefficients estimated we are able to
predict novel data-sets:

```{r, eval=FALSE}
> X.new <- matrix(rnorm(10*ncol(X)), nrow=10)
> pred  <- predict(fit, X.new)
> pred
         YBL113C     YBR013C     YBR014C    YBR016W    YBR025C    YBR028C
 [1,]  0.34896146  0.18351965 -0.08242679 -0.1369911 0.09521875 0.09709554
 [2,]  0.34846254  0.30982988 -0.08242679 -0.1369911 0.09521875 0.09709554
 [3,]  0.49168654  0.24786801 -0.08242679 -0.1369911 0.09521875 0.09709554
 [4,]  0.29359257  0.13512114 -0.08242679 -0.1369911 0.09521875 0.09709554
 [5,] -0.33368500 -0.09395486 -0.08242679 -0.1369911 0.09521875 0.09709554
 [6,]  0.37459188  0.24592816 -0.08242679 -0.1369911 0.09521875 0.09709554
 [7,]  0.02020576  0.06307481 -0.08242679 -0.1369911 0.09521875 0.09709554
 [8,]  0.08688461  0.23227053 -0.08242679 -0.1369911 0.09521875 0.09709554
 [9,] -0.06616525 -0.06917618 -0.08242679 -0.1369911 0.09521875 0.09709554
[10,] -0.44448282  0.09864389 -0.08242679 -0.1369911 0.09521875 0.09709554
```

The `pred` objects contains the predicted values for the responses.

### Model selection

In most cases we do not have the optimal shrinkage parameters $\lambda$, 
$\psi_{gx}$ and $\psi_{gy}$. For these settings you can use `netReg`'s 
included model selection. We use Powell's *BOBYQA* algorithm 
[@powell2009bobyqa] for gradient-free optimization that is included in the
`C++` library `Dlib`. Doing the model selection only requires calling 
`cv.edgenet`:

```{r, eval=FALSE}
> cv <- cv.edgenet(X=X, Y=Y, G.Y=GY, family="gaussian", maxit=1000)
> cv

Call: cv.edgenet.default(X = X, Y = Y, G.Y = GY, maxit = 1000, family = "gaussian")

Parameters:
lambda  psigx  psigy 
     0      0      0 
Family:
[1] "gaussian"
```

You can use the fitted parameters for the normal `edgenet` function. 
In this scenario $\lambda$, $\psi_{gx}$ and $\psi_{gy}$ should be 
roughly $0$ for two reasons:

* we had enough data and a small number of covariables ($n > p$), so we can 
find the *BLUE* estimator,
* in this toy example our prior graph $\mathbf{GY}$ had little impact.

## References
